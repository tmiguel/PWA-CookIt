<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef Móvel - PWA de Receitas</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1.5.10/css/pico.min.css">
    <link rel="stylesheet" href="styles.css">

    <!-- Importação do Firebase SDKs via CDN (Compat Versions) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
</head>
<body>
    <!-- Overlay de Carregamento (Loader) -->
    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(240, 244, 247, 0.9); z-index: 9999; display: none; justify-content: center; align-items: center; flex-direction: column;">
        <p aria-busy="true">A processar...</p>
        <p>Aguarde um momento.</p>
    </div>
    
    <!-- O Container Principal da Aplicação -->
    <div id="app-container" class="container">
        
        <!-- VIEW: LOGIN -->
        <article id="view-login" style="display: none;">
            <h2>Acesso ao Chef Móvel</h2>
            <p>Faça login para gerenciar suas receitas globais.</p>
            
            <form id="login-form">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" name="email" required>
                <label for="login-password">Password</label>
                <input type="password" id="login-password" name="password" required>
                <button type="submit" class="primary">Entrar (Email/Pass)</button>
            </form>

            <p style="text-align: center; margin: 1rem 0;">— OU —</p>
            
            <button id="login-google" class="secondary">
                Entrar com Google
            </button>

            <p id="auth-message" role="alert" style="color: red; margin-top: 1rem;"></p>
        </article>


        <!-- VIEW: APLICAÇÃO PRINCIPAL -->
        <div id="app-content" style="display: none;">
            
            <!-- CABEÇALHO COM ÍCONE E LOGOUT CORRIGIDO -->
            <header class="header-app" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center;">
                    <img src="/assets/icon-192x192.png" alt="Chef Móvel Ícone" style="height: 32px; width: 32px; margin-right: 10px;">
                    <h1>Receitas PWA</h1> <!-- Título Encurtado -->
                </div>
                <!-- Botão de Logout com estilo para ser compacto e garantir que cabe -->
                <button id="btn-logout" class="contrast outline" 
            style="margin: 0; padding: 0.5rem; white-space: nowrap; font-weight: bold; font-size: 0.8rem; color: white !important; border-color: white !important;">
        Sair
                </button>
            </header>

            <!-- 1. Lista de Receitas (#recipes) -->
            <article id="view-recipes" style="display: none;">
                <h2>Lista de Receitas</h2>
                <p role="alert" id="status-conexao">A testar conexão...</p>
                <div id="lista-receitas">
                    <p aria-busy="true">A carregar receitas...</p>
                </div>
            </article>

            <!-- 2. Formulário de Receita (#add) -->
            <article id="view-form" style="display: none;">
                <h2>Adicionar/Editar Receita</h2>
                <form id="recipe-form">
                    <label for="titulo">Título da Receita</label>
                    <input type="text" id="titulo" name="titulo" required>
                    <label for="ingredientes">Ingredientes (um por linha)</label>
                    <textarea id="ingredientes" name="ingredientes" rows="5" required></textarea>
                    <label for="passos">Passos (instruções)</label>
                    <textarea id="passos" name="passos" rows="5"></textarea>
                    
                    <fieldset id="recipe-config-options">
                        <legend>Tags da Receita</legend>
                        <p>Loading tags...</p>
                    </fieldset>
                    
                    <button type="submit" id="btn-salvar-receita" class="primary">Salvar Receita</button>
                    <button type="button" class="secondary" onclick="window.location.hash = '#recipes'">Cancelar</button>
                </form>
            </article>

            <!-- 3. Lista de Compras (#shoppinglist) -->
            <article id="view-shoppinglist" style="display: none;">
                <h2>Lista de Compras</h2>
                <div id="lista-compras-conteudo">
                    <p>Nenhum ingrediente adicionado.</p>
                </div>
            </article>

            <!-- 4. Página de Configurações (#settings) -->
            <article id="view-settings" style="display: none;">
                <h2>Configurações</h2>
                
                <nav>
                    <ul>
                        <li><a href="#settings/tags">Tags</a></li>
                        <li><a href="#settings/units">Unidades de Medida</a></li>
                    </ul>
                </nav>
                
                <div id="settings-sub-view">
                    <p>Selecione uma opção acima.</p>
                </d
