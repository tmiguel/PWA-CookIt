<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef M√≥vel - PWA de Receitas</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1.5.10/css/pico.min.css">
    <link rel="stylesheet" href="styles.css">

    <!-- Importa√ß√£o do Firebase SDKs via CDN (Compat Versions) -->
    <!-- ESTES T√äM DE ESTAR AQUI PARA O 'firebase' SER GLOBAL PARA OS M√ìDULOS -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
</head>
<body>
    <!-- Overlay de Carregamento (Loader) -->
    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(240, 244, 247, 0.9); z-index: 9999; display: none; justify-content: center; align-items: center; flex-direction: column;">
        <p aria-busy="true">A processar...</p>
        <p>Aguarde um momento.</p>
    </div>
    
    <!-- O Container Principal da Aplica√ß√£o -->
    <div id="app-container" class="container">
        
        <!-- VIEW: LOGIN -->
        <article id="view-login" style="display: none;">
            <h2>Acesso ao Chef M√≥vel</h2>
            <p>Fa√ßa login para gerenciar suas receitas globais.</p>
            
            <form id="login-form">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" name="email" required>
                <label for="login-password">Password</label>
                <input type="password" id="login-password" name="password" required>
                <button type="submit" class="primary">Entrar (Email/Pass)</button>
            </form>

            <p style="text-align: center; margin: 1rem 0;">‚Äî OU ‚Äî</p>
            
            <button id="login-google" class="secondary">
                Entrar com Google
            </button>

            <p id="auth-message" role="alert" style="color: red; margin-top: 1rem;"></p>
        </article>


        <!-- VIEW: APLICA√á√ÉO PRINCIPAL -->
        <div id="app-content" style="display: none;">
            
            <header class="header-app" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center;">
                    <img src="/assets/icon-192x192.png" alt="Chef M√≥vel √çcone" style="height: 32px; width: 32px; margin-right: 10px;">
                    <h1>Chef M√≥vel</h1>
                </div>
                <button id="btn-logout" class="contrast outline" style="margin: 0; padding: 0.5rem;">Sair</button>
            </header>

            <!-- 1. Lista de Receitas (#recipes) -->
            <article id="view-recipes" style="display: none;">
                <h2>Lista de Receitas</h2>
                <p role="alert" id="status-conexao">A testar conex√£o...</p>
                <div id="lista-receitas">
                    <p aria-busy="true">A carregar receitas...</p>
                </div>
            </article>

            <!-- 2. Formul√°rio de Receita (#add) -->
            <article id="view-form" style="display: none;">
                <h2>Adicionar/Editar Receita</h2>
                <form id="recipe-form">
                    <label for="titulo">T√≠tulo da Receita</label>
                    <input type="text" id="titulo" name="titulo" required>
                    <label for="ingredientes">Ingredientes (um por linha)</label>
                    <textarea id="ingredientes" name="ingredientes" rows="5" required></textarea>
                    <label for="passos">Passos (instru√ß√µes)</label>
                    <textarea id="passos" name="passos" rows="5"></textarea>
                    
                    <fieldset id="recipe-config-options">
                        <legend>Tags da Receita</legend>
                        <p>Loading tags...</p>
                    </fieldset>
                    
                    <button type="submit" id="btn-salvar-receita" class="primary">Salvar Receita</button>
                    <button type="button" class="secondary" onclick="window.location.hash = '#recipes'">Cancelar</button>
                </form>
            </article>

            <!-- 3. Lista de Compras (#shoppinglist) -->
            <article id="view-shoppinglist" style="display: none;">
                <h2>Lista de Compras</h2>
                <div id="lista-compras-conteudo">
                    <p>Nenhum ingrediente adicionado.</p>
                </div>
            </article>

            <!-- 4. P√°gina de Configura√ß√µes (#settings) -->
            <article id="view-settings" style="display: none;">
                <h2>Configura√ß√µes</h2>
                
                <nav>
                    <ul>
                        <li><a href="#settings/tags">Tags</a></li>
                        <li><a href="#settings/units">Unidades de Medida</a></li>
                    </ul>
                </nav>
                
                <div id="settings-sub-view">
                    <p>Selecione uma op√ß√£o acima.</p>
                </div>
                
            </article>
        </div>
        <!-- FIM: app-content -->
    </div>

    <!-- Barra de Navega√ß√£o M√≥vel -->
    <nav id="bottom-nav-bar" class="container" style="position: fixed; bottom: 0; left: 0; width: 100%; padding: 10px 0; background-color: var(--pico-background-color); display: none;">
        <ul>
            <li><a href="#recipes" role="button">üçΩÔ∏è Receitas</a></li>
            <li><a href="#shoppinglist" role="button" class="secondary">üõí Compras</a></li>
            <li><a href="#add" role="button" class="contrast">‚ûï Adicionar</a></li>
            <li><a href="#settings" role="button" class="secondary">‚öôÔ∏è Config</a></li>
        </ul>
    </nav>
    <div style="height: 60px;"></div>


    <!-- ============================================== -->
    <!-- SCRIPTS MODULARES (ES Modules) - APENAS O MAIN.JS -->
    <!-- ============================================== -->
    <script type="module" src="main.js"></script> 
    
    <!-- Ficheiro para o Service Worker (N√£o modular) -->
    <script src="service-worker-register.js"></script>
</body>
</html>
